{% extends '../admin/admin_base.html' %}


{% block content %}
<table id="myTable" class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>Sr. No.</th>
            <th>Product Name</th>
            <th>Price</th>
            <th>Categoey</th>
            <th>Manufacture Date</th>
            <th>Expiry Date</th>
            <th>Action</th>

        </tr>
    </thead>
    <tfoot>
    </tfoot>
    <tbody>
        {% for object in data %}
        <tr>
            <td>{{forloop.counter}}</td>
            <td>{{ object.product_name }}</td>
            <td>{{ object.product_price }}</td>
            <td>{{ object.product_category }}</td>
            <td>{{ object.manufacture_date }}</td>
            <td>{{ object.expiry_date }}</td>
            <td>
                <button type="button" id="showbtn" title="Order Delivered" data-placement="bottom"
                    title="Tooltip on bottom" id="" class="btn btn-primary btn-sm update" data-id="{{object.id}}"
                    data-product_name="{{object.product_name}}" data-product_price="{{object.product_price}}"
                    data-product_category="{{object.product_category}}"
                    data-manufacture_date="{{object.manufacture_date}}" data-expiry_date="{{object.expiry_date}}"
                    data-language="{{obj.language}}">Update</button>

                <button type="button" id="showbtn" title="Order Delivered" data-placement="bottom"
                    title="Tooltip on bottom" class="btn btn-primary btn-sm delete"
                    data-id="{{object.id}}">Delete</button>

            </td>



        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- update Book Modal -->
<div class="modal fade" id="add_mark" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Update Product</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Are you sure, <br>You want to cancel the order? -->


                <div class="form-group">
                    <label for="exampleInputEmail1">Product Name</label>
                    <input type="text" class="form-control" name="product_name" placeholder="Enter Product Name"
                        id="product_name">
                </div>

                <div class="form-group">
                    <label for="exampleInputEmail1">Product Price</label>
                    <input type="text" class="form-control" name="product_price" placeholder="Enter price"
                        id="product_price">
                </div>
                <div class="form-group">
                    <label for="exampleInputPassword1">Category</label>
                    <select name="category" id="category" class="form-control">Product Category
                        <option value="" id="category"></option>
                        {% for obj in category %}
                        <option value="{{obj.category}}">{{obj.category}}</option>
                        {% endfor %}

                    </select>
                </div>
                <div class="form-group">
                    <label for="exampleInputEmail1">Manufacture Date</label>
                    <input type="date" class="form-control" name="manufacture_date" placeholder="Manufacture date"
                        id="manufacture_date">
                </div>
                <div class="form-group">
                    <label for="exampleInputEmail1">Expiry Date</label>
                    <input type="date" class="form-control" name="expiry_date" placeholder="Expiry date"
                        id="expiry_date">
                </div>
                <input type="hidden" class="form-control" name="product_id" id="product_id">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>

                <button type="button" class="btn btn-primary" onclick="update_product()">Submit</button>

            </div>
        </div>
    </div>
</div>
<!-- end update book modal -->
<!-- update Book Modal -->
<div class="modal fade" id="delete_pro" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Delete Product</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure, <br>You want to delete the product?




                <input type="hidden" class="form-control" name="pro_id" id="pro_id">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>

                <button type="button" class="btn btn-primary" onclick="delete_product()">Submit</button>

            </div>
        </div>
    </div>
</div>
<!-- end update book modal -->
<script>
    $(document).ready(function () {
        $('#myTable').DataTable();
    });


    $(".update").on("click", function () {
        var id = $(this).data("id");
        var p_name = $(this).data("product_name");

        var p_price = $(this).data("product_price");
        var p_category = $(this).data("product_category");
        var p_manufacture = $(this).data("manufacture_date");
        var p_expiry = $(this).data("expiry_date");

        console.log(p_expiry)
        $("#product_id").val(id)
        $("#product_name").val(p_name)

        $("#product_price").val(p_price)
        $("#category").val(p_category)
        $("#manufacture_date").val(p_manufacture)
        $("#expiry_date").val(p_expiry)

        $("#add_mark").modal()



    })

    function update_product() {
        var id = $("#product_id").val()
        var name = $("#product_name").val()

        var price = $("#product_price").val()
        var category = $("#category").val()
        var manufacture = $("#manufacture_date").val()
        var expiry = $("#expiry_date").val()
        console.log(expiry)

        $.ajax({
            method: "POST",
            url: "/update_product/",
            data: {
                'p_id': id,
                'name': name,
                'price': price,
                'category': category,
                'manufacture': manufacture,
                'expiry': expiry,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function (response) {
                if (response.status == '1') {
                    swal("" + response.msg + "", {
                        icon: "success",
                        button: "Ok",
                        closeOnClickOutside: false,
                    }).then(function () {
                        window.location.reload();
                    });
                }
                else {
                    swal("" + response.msg + "", {
                        icon: "info",
                        button: "Ok",
                        closeOnClickOutside: true,
                    }).then(function () {
                        location.reload
                    });
                }
            }

        })
    }

    $(".delete").on("click", function () {
        var id = $(this).data("id");
        console.log(id)
        $("#pro_id").val(id)
        $("#delete_pro").modal()
    })

    function delete_product() {
        var id = $("#pro_id").val()

        console.log(id)

        $.ajax({
            method: "POST",
            url: "/delete_product/",
            data: {
                'p_id': id,

                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function (response) {
                if (response.status == '1') {
                    swal("" + response.msg + "", {
                        icon: "success",
                        button: "Ok",
                        closeOnClickOutside: false,
                    }).then(function () {
                        window.location.reload();
                    });
                }
                else {
                    swal("" + response.msg + "", {
                        icon: "info",
                        button: "Ok",
                        closeOnClickOutside: true,
                    }).then(function () {
                        location.reload
                    });
                }
            }

        })
    }
</script>
{% endblock content %}